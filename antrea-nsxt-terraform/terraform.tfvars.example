# NSX-T Manager Configuration
nsx_manager          = "nsx-manager.example.com"
nsx_username         = "admin"
nsx_password         = "CHANGE_ME"  # Store this in terraform.tfvars (gitignored)
allow_unverified_ssl = true

# Antrea Cluster Configuration
cluster_control_plane_id = "a9f2d700-30a3-4e5d-9fd9-622d15219d6b-e2e-ns-6j7x6-e2e-niran-cls01-antrea"

# Policy Configuration
policy_name          = "prod"
policy_display_name  = "music-store-prod"
policy_category      = "Application"
policy_sequence_number = 499999
policy_stateful      = true
policy_tcp_strict    = true

# Security Groups - based on Kubernetes labels
security_groups = {
  "music-store-frontend" = {
    display_name = "Music-store-frontend"
    description  = "Music store frontend service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "app"
      operator    = "EQUALS"
      value       = "music-store-1"
    }]
  }
  "store-service" = {
    display_name = "store-service"
    description  = "Music store main service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "service-name"
      operator    = "EQUALS"
      value       = "store"
    }]
  }
  "cart-service" = {
    display_name = "cart-service"
    description  = "Shopping cart service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "service-name"
      operator    = "EQUALS"
      value       = "cart"
    }]
  }
  "order-service" = {
    display_name = "order-service"
    description  = "Order processing service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "service-name"
      operator    = "EQUALS"
      value       = "order"
    }]
  }
  "users-service" = {
    display_name = "users-service"
    description  = "User management service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "service-name"
      operator    = "EQUALS"
      value       = "users"
    }]
  }
  "database-service" = {
    display_name = "database-service"
    description  = "PostgreSQL database service"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "service-name"
      operator    = "EQUALS"
      value       = "database"
    }]
  }
  "music-store" = {
    display_name = "music-store"
    description  = "All music store services"
    criteria = [{
      member_type = "VirtualMachine"
      key         = "app-name"
      operator    = "EQUALS"
      value       = "music-store"
    }]
  }
}

# Security Rules - based on CSV data
security_rules = [
  {
    display_name       = "frontend"
    description        = "Allow external access to frontend"
    action             = "ALLOW"
    sequence_number    = 249999
    source_groups      = ["ANY"]
    destination_groups = ["Music-store-frontend"]
    services           = []
    destination_ports  = ["5000"]
    protocol           = "TCP"
    scope_groups       = ["Music-store-frontend"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "store->cart"
    description        = "Allow store service to access cart service"
    action             = "ALLOW"
    sequence_number    = 124999
    source_groups      = ["store-service"]
    destination_groups = ["cart-service"]
    services           = []
    destination_ports  = ["5002"]
    protocol           = "TCP"
    scope_groups       = ["cart-service"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "store->users"
    description        = "Allow store service to access users service"
    action             = "ALLOW"
    sequence_number    = 31249
    source_groups      = ["store-service"]
    destination_groups = ["users-service"]
    services           = []
    destination_ports  = ["5003"]
    protocol           = "TCP"
    scope_groups       = ["users-service"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "store->database"
    description        = "Allow store service to access database"
    action             = "ALLOW"
    sequence_number    = 15624
    source_groups      = ["store-service"]
    destination_groups = ["database-service"]
    services           = []
    destination_ports  = ["5432"]
    protocol           = "TCP"
    scope_groups       = ["database-service"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "store->order"
    description        = "Allow store service to access order service"
    action             = "ALLOW"
    sequence_number    = 62499
    source_groups      = ["store-service"]
    destination_groups = ["order-service"]
    services           = []
    destination_ports  = ["5001"]
    protocol           = "TCP"
    scope_groups       = ["order-service"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "cart->order"
    description        = "Allow cart service to access order service"
    action             = "ALLOW"
    sequence_number    = 7812
    source_groups      = ["cart-service"]
    destination_groups = ["order-service"]
    services           = []
    destination_ports  = ["5001"]
    protocol           = "TCP"
    scope_groups       = ["order-service"]
    direction          = "IN"
    logged             = false
    disabled           = false
  },
  {
    display_name       = "cleanup"
    description        = "Drop all other traffic to music store"
    action             = "DROP"
    sequence_number    = 499999
    source_groups      = ["ANY"]
    destination_groups = ["ANY"]
    services           = ["ANY"]
    destination_ports  = []
    protocol           = ""
    scope_groups       = ["music-store"]
    direction          = "IN"
    logged             = false
    disabled           = false
  }
]

